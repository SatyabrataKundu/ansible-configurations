---

- hosts: ucs
  connection: local
  gather_facts: no

  tasks:
  - name: Test that we have a UCS host, UCS username, and UCS password
    fail:
      msg: 'Please define the following variables: ucs_hostname, ucs_username and ucs_password.'
    when: ucs_hostname is not defined or ucs_username is not defined or ucs_password is not defined
    vars:
      login_info: &login_info
        hostname: "{{ ucs_hostname }}"
        username: "{{ ucs_username }}"
        password: "{{ ucs_password }}"

  - name: Create Server BIOS Policy - JSON
    ucs_managed_objects:
      <<: *login_info
      objects:
      - {
          "module": "ucsmsdk.mometa.bios.BiosVProfile",
          "class": "BiosVProfile",
          "properties": {
              "parent_mo_or_dn": "org-root",
              "name": "test-child-json",
              "reboot_on_update": "yes"
              },
              "children": [
                {
                    "module": "ucsmsdk.mometa.bios.BiosVfQuietBoot",
                    "class": "BiosVfQuietBoot",
                    "properties": {
                        "vp_quiet_boot": "disabled"
                    }
                },{
                    "module": "ucsmsdk.mometa.bios.BiosVfResumeOnACPowerLoss",
                    "class": "BiosVfResumeOnACPowerLoss",
                    "properties": {
                        "vp_resume_on_ac_power_loss": "stay-off"
                    }
                },{
                    "module": "ucsmsdk.mometa.bios.BiosVfConsoleRedirection",
                    "class": "BiosVfConsoleRedirection",
                    "properties": {
                        "vp_baud_rate": "9600",
                        "vp_console_redirection": "com-0",
                        "vp_terminal_type": "pc-ansi"
                    }
                }]
      }
  - name: Create Server BIOS Policy - YAML
    ucs_managed_objects:
      <<: *login_info
      objects:
      - module: ucsmsdk.mometa.bios.BiosVProfile
        class: BiosVProfile
        properties:
            parent_mo_or_dn: org-root
            name: test-child-yaml
            reboot_on_update: "yes"
        children:
          - module: ucsmsdk.mometa.bios.BiosVfQuietBoot
            class: BiosVfQuietBoot
            properties:
              vp_quiet_boot: disabled
          - module: ucsmsdk.mometa.bios.BiosVfResumeOnACPowerLoss
            class: BiosVfResumeOnACPowerLoss
            properties:
              vp_resume_on_ac_power_loss: stay-off
          - module: ucsmsdk.mometa.bios.BiosVfConsoleRedirection
            class: BiosVfConsoleRedirection
            properties:
              vp_baud_rate: "9600"
              vp_console_redirection: com-0
              vp_terminal_type: pc-ansi